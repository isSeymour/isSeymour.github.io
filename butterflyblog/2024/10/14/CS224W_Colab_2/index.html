<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>CS224W - Colab 2 | isSeymour</title><meta name="author" content="isSeymour"><meta name="copyright" content="isSeymour"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="CS224W - Colab 2 In Colab 2, we will work to construct our own graph neural network using PyTorch Geometric (PyG) and then apply that model on two Open Graph Benchmark (OGB) datasets. These two datase">
<meta property="og:type" content="article">
<meta property="og:title" content="CS224W - Colab 2">
<meta property="og:url" content="https://isseymour.github.io/butterflyblog/2024/10/14/CS224W_Colab_2/index.html">
<meta property="og:site_name" content="isSeymour">
<meta property="og:description" content="CS224W - Colab 2 In Colab 2, we will work to construct our own graph neural network using PyTorch Geometric (PyG) and then apply that model on two Open Graph Benchmark (OGB) datasets. These two datase">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/isSeymour/PicGo/posts/CS224W/GCN/shared-parameters.png">
<meta property="article:published_time" content="2024-10-14T14:00:00.000Z">
<meta property="article:modified_time" content="2024-10-14T14:00:00.000Z">
<meta property="article:author" content="isSeymour">
<meta property="article:tag" content="GNN">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/isSeymour/PicGo/posts/CS224W/GCN/shared-parameters.png"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/Seymour0314/PicGo/blog/page_img/IC1011.ico"><link rel="canonical" href="https://isseymour.github.io/butterflyblog/2024/10/14/CS224W_Colab_2/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/butterflyblog/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/butterflyblog/',
  algolia: undefined,
  localSearch: {"path":"/butterflyblog/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'CS224W - Colab 2',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-10-14 22:00:00'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/butterflyblog/code/style.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://cdn.jsdelivr.net/gh/Seymour0314/PicGo/blog/page_img/T6.jpg" onerror="onerror=null;src='https://cdn.jsdelivr.net/gh/Seymour0314/PicGo/blog/page_img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/butterflyblog/archives/"><div class="headline">文章</div><div class="length-num">67</div></a><a href="/butterflyblog/tags/"><div class="headline">标签</div><div class="length-num">34</div></a><a href="/butterflyblog/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-solid fa-bookmark"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/butterflyblog/archives/"><i class="fa-fw fa-solid fa-timeline"></i><span> 总览</span></a></li><li><a class="site-page child" href="/butterflyblog/tags/"><i class="fa-fw fa-sharp fa-solid fa-hashtag"></i><span> 标签</span></a></li><li><a class="site-page child" href="/butterflyblog/categories/"><i class="fa-fw fa-sharp fa-solid fa-folder"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-sharp fa-solid fa-list"></i><span> 功能</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/butterflyblog/ctf/"><i class="fa-fw fa-solid fa-shield-halved"></i><span> CTF</span></a></li><li><a class="site-page child" href="/butterflyblog/music/"><i class="fa-fw fa-solid fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/butterflyblog/tools/"><i class="fa-fw fa-solid fa-screwdriver-wrench"></i><span> 下载</span></a></li><li><a class="site-page child" href="/butterflyblog/link/"><i class="fa-fw fa-solid fa-paper-plane"></i><span> 链接</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-solid fa-university"></i><span> 算法</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/butterflyblog/algorithm/hot100/"><i class="fa-fw fa-solid fa-fire"></i><span> HOT100</span></a></li><li><a class="site-page child" href="/butterflyblog/algorithm/template/"><i class="fa-fw fa-solid fa-code"></i><span> Template</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-solid fa-plane"></i><span> 旅途</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/butterflyblog/journey/diary/"><i class="fa-fw fa-solid fa-hashtag"></i><span> 心路</span></a></li><li><a class="site-page child" href="/butterflyblog/journey/english/"><i class="fa-fw fa-solid fa-globe"></i><span> 英语</span></a></li><li><a class="site-page child" href="/butterflyblog/journey/major/"><i class="fa-fw fa-solid fa-map"></i><span> 专业课</span></a></li><li><a class="site-page child" href="/butterflyblog/journey/mathAI/"><i class="fa-fw fa-solid fa-bar-chart"></i><span> 数学&amp;AI</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-regular fa-user"></i><span> 关于</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/butterflyblog/about/"><i class="fa-fw fa-regular fa-user"></i><span> 关于我</span></a></li><li><a class="site-page child" href="/butterflyblog/message/"><i class="fa-fw fa-solid fa-message"></i><span> 留言板</span></a></li><li><a class="site-page child" href="/butterflyblog/develop/"><i class="fa-fw fa-brands fa-windows"></i><span> 开发日志</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/isSeymour/PicGo/posts/CS224W/GCN/shared-parameters.png')"><nav id="nav"><span id="blog-info"><a href="/butterflyblog/" title="isSeymour"><span class="site-name">isSeymour</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-solid fa-bookmark"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/butterflyblog/archives/"><i class="fa-fw fa-solid fa-timeline"></i><span> 总览</span></a></li><li><a class="site-page child" href="/butterflyblog/tags/"><i class="fa-fw fa-sharp fa-solid fa-hashtag"></i><span> 标签</span></a></li><li><a class="site-page child" href="/butterflyblog/categories/"><i class="fa-fw fa-sharp fa-solid fa-folder"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-sharp fa-solid fa-list"></i><span> 功能</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/butterflyblog/ctf/"><i class="fa-fw fa-solid fa-shield-halved"></i><span> CTF</span></a></li><li><a class="site-page child" href="/butterflyblog/music/"><i class="fa-fw fa-solid fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/butterflyblog/tools/"><i class="fa-fw fa-solid fa-screwdriver-wrench"></i><span> 下载</span></a></li><li><a class="site-page child" href="/butterflyblog/link/"><i class="fa-fw fa-solid fa-paper-plane"></i><span> 链接</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-solid fa-university"></i><span> 算法</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/butterflyblog/algorithm/hot100/"><i class="fa-fw fa-solid fa-fire"></i><span> HOT100</span></a></li><li><a class="site-page child" href="/butterflyblog/algorithm/template/"><i class="fa-fw fa-solid fa-code"></i><span> Template</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-solid fa-plane"></i><span> 旅途</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/butterflyblog/journey/diary/"><i class="fa-fw fa-solid fa-hashtag"></i><span> 心路</span></a></li><li><a class="site-page child" href="/butterflyblog/journey/english/"><i class="fa-fw fa-solid fa-globe"></i><span> 英语</span></a></li><li><a class="site-page child" href="/butterflyblog/journey/major/"><i class="fa-fw fa-solid fa-map"></i><span> 专业课</span></a></li><li><a class="site-page child" href="/butterflyblog/journey/mathAI/"><i class="fa-fw fa-solid fa-bar-chart"></i><span> 数学&amp;AI</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-regular fa-user"></i><span> 关于</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/butterflyblog/about/"><i class="fa-fw fa-regular fa-user"></i><span> 关于我</span></a></li><li><a class="site-page child" href="/butterflyblog/message/"><i class="fa-fw fa-solid fa-message"></i><span> 留言板</span></a></li><li><a class="site-page child" href="/butterflyblog/develop/"><i class="fa-fw fa-brands fa-windows"></i><span> 开发日志</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">CS224W - Colab 2</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-10-14T14:00:00.000Z" title="发表于 2024-10-14 22:00:00">2024-10-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-10-14T14:00:00.000Z" title="更新于 2024-10-14 22:00:00">2024-10-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/butterflyblog/categories/CS224W/">CS224W</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>25分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="CS224W - Colab 2"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1><strong>CS224W - Colab 2</strong></h1>
<p>In Colab 2, we will work to construct our own graph neural network using PyTorch Geometric (PyG) and then apply that model on two Open Graph Benchmark (OGB) datasets. These two datasets will be used to benchmark your model’s performance on two different graph-based tasks: 1) node property prediction, predicting properties of single nodes and 2) graph property prediction, predicting properties of entire graphs or subgraphs.</p>
<p>First, we will learn how PyTorch Geometric stores graphs as PyTorch tensors.</p>
<p>Then, we will load and inspect one of the Open Graph Benchmark (OGB) datasets by using the <code>ogb</code> package. OGB is a collection of realistic, large-scale, and diverse benchmark datasets for machine learning on graphs. The <code>ogb</code> package not only provides data loaders for each dataset but also model evaluators.</p>
<p>Lastly, we will build our own graph neural network using PyTorch Geometric. We will then train and evaluate our model on the OGB node property prediction and graph property prediction tasks.</p>
<p><strong>Note</strong>: Make sure to <strong>sequentially run all the cells in each section</strong>, so that the intermediate variables / packages will carry over to the next cell</p>
<p>We recommend you save a copy of this colab in your drive so you don’t lose progress!</p>
<p>The expected time to finish this Colab is 2 hours. However, debugging training loops can easily take a while. So, don’t worry at all if it takes you longer! Have fun and good luck on Colab 2 :)</p>
<h1>Device</h1>
<p>You might need to use a GPU for this Colab to run quickly.</p>
<p>Please click <code>Runtime</code> and then <code>Change runtime type</code>. Then set the <code>hardware accelerator</code> to <strong>GPU</strong>.</p>
<h1>Setup</h1>
<p>As discussed in Colab 0, the installation of PyG on Colab can be a little bit tricky. First let us check which version of PyTorch you are running</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;PyTorch has version &#123;&#125;&quot;</span>.<span class="built_in">format</span>(torch.__version__))</span><br></pre></td></tr></table></figure>
<pre><code>PyTorch has version 2.4.1
</code></pre>
<p>Download the necessary packages for PyG. Make sure that your version of torch matches the output from the cell above. In case of any issues, more information can be found on the <a target="_blank" rel="noopener" href="https://pytorch-geometric.readthedocs.io/en/latest/notes/installation.html">PyG’s installation page</a>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Install torch geometric</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;IS_GRADESCOPE_ENV&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> os.environ:</span><br><span class="line">    torch_version = <span class="built_in">str</span>(torch.__version__)</span><br><span class="line">    scatter_src = <span class="string">f&quot;https://pytorch-geometric.com/whl/torch-<span class="subst">&#123;torch_version&#125;</span>.html&quot;</span></span><br><span class="line">    sparse_src = <span class="string">f&quot;https://pytorch-geometric.com/whl/torch-<span class="subst">&#123;torch_version&#125;</span>.html&quot;</span></span><br><span class="line">    !pip install torch-scatter -f $scatter_src</span><br><span class="line">    !pip install torch-sparse -f $sparse_src</span><br><span class="line">    !pip install torch-geometric</span><br><span class="line">    !pip install ogb</span><br></pre></td></tr></table></figure>
<h1>1) PyTorch Geometric (Datasets and Data)</h1>
<p>PyTorch Geometric has two classes for storing and/or transforming graphs into tensor format. One is <code>torch_geometric.datasets</code>, which contains a variety of common graph datasets. Another is <code>torch_geometric.data</code>, which provides the data handling of graphs in PyTorch tensors.</p>
<p>In this section, we will learn how to use <code>torch_geometric.datasets</code> and <code>torch_geometric.data</code> together.</p>
<h2 id="PyG-Datasets">PyG Datasets</h2>
<p>The <code>torch_geometric.datasets</code> class has many common graph datasets. Here we will explore its usage through one example dataset.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torch_geometric.datasets <span class="keyword">import</span> TUDataset</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;IS_GRADESCOPE_ENV&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> os.environ:</span><br><span class="line">    root = <span class="string">&#x27;./enzymes&#x27;</span></span><br><span class="line">    name = <span class="string">&#x27;ENZYMES&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># The ENZYMES dataset</span></span><br><span class="line">    pyg_dataset= TUDataset(root, name)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># You will find that there are 600 graphs in this dataset</span></span><br><span class="line">    <span class="built_in">print</span>(pyg_dataset)</span><br></pre></td></tr></table></figure>
<pre><code>ENZYMES(600)
</code></pre>
<h2 id="Question-1-What-is-the-number-of-classes-and-number-of-features-in-the-ENZYMES-dataset-5-points">Question 1: What is the number of classes and number of features in the ENZYMES dataset? (5 points)</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_num_classes</span>(<span class="params">pyg_dataset</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;获取数据集的类别数量&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> pyg_dataset.num_classes</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_num_features</span>(<span class="params">pyg_dataset</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;获取特征数量&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> pyg_dataset.num_features</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;IS_GRADESCOPE_ENV&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> os.environ:</span><br><span class="line">    num_classes = get_num_classes(pyg_dataset)</span><br><span class="line">    num_features = get_num_features(pyg_dataset)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125; dataset has &#123;&#125; classes&quot;</span>.<span class="built_in">format</span>(name, num_classes))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125; dataset has &#123;&#125; features&quot;</span>.<span class="built_in">format</span>(name, num_features))</span><br></pre></td></tr></table></figure>
<pre><code>ENZYMES dataset has 6 classes
ENZYMES dataset has 3 features
</code></pre>
<h2 id="PyG-Data">PyG Data</h2>
<p>Each PyG dataset stores a list of <code>torch_geometric.data.Data</code> objects, where each <code>torch_geometric.data.Data</code> object represents a graph. We can easily get the <code>Data</code> object by indexing into the dataset.</p>
<p>For more information such as what is stored in the <code>Data</code> object, please refer to the <a target="_blank" rel="noopener" href="https://pytorch-geometric.readthedocs.io/en/latest/modules/data.html#torch_geometric.data.Data">documentation</a>.</p>
<h2 id="Question-2-What-is-the-label-of-the-graph-with-index-100-in-the-ENZYMES-dataset-5-points">Question 2: What is the label of the graph with index 100 in the ENZYMES dataset? (5 points)</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_graph_class</span>(<span class="params">pyg_dataset, idx</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;返回索引idx节点的分类标签&#x27;&#x27;&#x27;</span></span><br><span class="line">    label = pyg_dataset[idx].y.item()</span><br><span class="line">    <span class="keyword">return</span> label</span><br><span class="line"></span><br><span class="line"><span class="comment"># Here pyg_dataset is a dataset for graph classification</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;IS_GRADESCOPE_ENV&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> os.environ:</span><br><span class="line">    graph_0 = pyg_dataset[<span class="number">0</span>]</span><br><span class="line">    <span class="built_in">print</span>(graph_0)</span><br><span class="line">    idx = <span class="number">100</span></span><br><span class="line">    label = get_graph_class(pyg_dataset, idx)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Graph with index &#123;&#125; has label &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(idx, label))</span><br></pre></td></tr></table></figure>
<pre><code>Data(edge_index=[2, 168], x=[37, 3], y=[1])
Graph with index 100 has label 4
</code></pre>
<h2 id="Question-3-How-many-edges-does-the-graph-with-index-200-have-5-points">Question 3: How many edges does the graph with index 200 have? (5 points)</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_graph_num_edges</span>(<span class="params">pyg_dataset, idx</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;获取idx节点的边数&#x27;&#x27;&#x27;</span></span><br><span class="line">    edge_index = pyg_dataset[idx].edge_index</span><br><span class="line">    num_edges = edge_index.size(<span class="number">1</span>) // <span class="number">2</span>   <span class="comment"># 无向</span></span><br><span class="line">    <span class="keyword">return</span> num_edges</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;IS_GRADESCOPE_ENV&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> os.environ:</span><br><span class="line">    idx = <span class="number">200</span></span><br><span class="line">    num_edges = get_graph_num_edges(pyg_dataset, idx)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Graph with index &#123;&#125; has &#123;&#125; edges&#x27;</span>.<span class="built_in">format</span>(idx, num_edges))</span><br></pre></td></tr></table></figure>
<pre><code>Graph with index 200 has 53 edges
</code></pre>
<h1>2) Open Graph Benchmark (OGB)</h1>
<p>The Open Graph Benchmark (OGB) is a collection of realistic, large-scale, and diverse benchmark datasets for machine learning on graphs. Its datasets are automatically downloaded, processed, and split using the OGB Data Loader. The model performance can then be evaluated by using the OGB Evaluator in a unified manner.</p>
<h2 id="Dataset-and-Data">Dataset and Data</h2>
<p>OGB also supports PyG dataset and data classes. Here we take a look on the <code>ogbn-arxiv</code> dataset.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch_geometric.transforms <span class="keyword">as</span> T</span><br><span class="line"><span class="keyword">from</span> ogb.nodeproppred <span class="keyword">import</span> PygNodePropPredDataset</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;IS_GRADESCOPE_ENV&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> os.environ:</span><br><span class="line">    dataset_name = <span class="string">&#x27;ogbn-arxiv&#x27;</span></span><br><span class="line">    <span class="comment"># Load the dataset and transform it to sparse tensor</span></span><br><span class="line">    dataset = PygNodePropPredDataset(name=dataset_name, transform=T.ToSparseTensor())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The &#123;&#125; dataset has &#123;&#125; graph&#x27;</span>.<span class="built_in">format</span>(dataset_name, <span class="built_in">len</span>(dataset)))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Extract the graph</span></span><br><span class="line">    data = dataset[<span class="number">0</span>]</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br></pre></td></tr></table></figure>
<pre><code>The ogbn-arxiv dataset has 1 graph
Data(num_nodes=169343, x=[169343, 128], node_year=[169343, 1], y=[169343, 1], adj_t=[169343, 169343, nnz=1166243])


/opt/anaconda3/envs/graph/lib/python3.11/site-packages/ogb/nodeproppred/dataset_pyg.py:69: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  self.data, self.slices = torch.load(self.processed_paths[0])
</code></pre>
<h2 id="Question-4-How-many-features-are-in-the-ogbn-arxiv-graph-5-points">Question 4: How many features are in the ogbn-arxiv graph? (5 points)</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">graph_num_features</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;获取特征数量&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> data.num_features</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;IS_GRADESCOPE_ENV&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> os.environ:</span><br><span class="line">    num_features = graph_num_features(data)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The graph has &#123;&#125; features&#x27;</span>.<span class="built_in">format</span>(num_features))</span><br></pre></td></tr></table></figure>
<pre><code>The graph has 128 features
</code></pre>
<h1>3) GNN: Node Property Prediction</h1>
<p>In this section we will build our first graph neural network using PyTorch Geometric. Then we will apply it to the task of node property prediction (node classification).</p>
<p>Specifically, we will use GCN as the foundation for your graph neural network (<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1609.02907.pdf">Kipf et al. (2017)</a>). To do so, we will work with PyG’s built-in <code>GCNConv</code> layer.</p>
<h2 id="Setup">Setup</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="built_in">print</span>(torch.__version__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># The PyG built-in GCNConv</span></span><br><span class="line"><span class="keyword">from</span> torch_geometric.nn <span class="keyword">import</span> GCNConv</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch_geometric.transforms <span class="keyword">as</span> T</span><br><span class="line"><span class="keyword">from</span> ogb.nodeproppred <span class="keyword">import</span> PygNodePropPredDataset, Evaluator</span><br></pre></td></tr></table></figure>
<pre><code>2.4.1
</code></pre>
<h2 id="Load-and-Preprocess-the-Dataset">Load and Preprocess the Dataset</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="string">&#x27;IS_GRADESCOPE_ENV&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> os.environ:</span><br><span class="line">    dataset_name = <span class="string">&#x27;ogbn-arxiv&#x27;</span></span><br><span class="line">    dataset = PygNodePropPredDataset(name=dataset_name, transform=T.ToSparseTensor())</span><br><span class="line">    data = dataset[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Make the adjacency matrix to symmetric</span></span><br><span class="line">    data.adj_t = data.adj_t.to_symmetric()</span><br><span class="line"></span><br><span class="line">    device = <span class="string">&#x27;cuda&#x27;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&#x27;cpu&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># If you use GPU, the device should be cuda</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Device: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(device))</span><br><span class="line"></span><br><span class="line">    data = data.to(device)</span><br><span class="line">    split_idx = dataset.get_idx_split()</span><br><span class="line">    train_idx = split_idx[<span class="string">&#x27;train&#x27;</span>].to(device)</span><br></pre></td></tr></table></figure>
<pre><code>Device: cpu
</code></pre>
<h2 id="GCN-Model">GCN Model</h2>
<p>Now we will implement our GCN model!</p>
<p>Please follow the figure below to implement the <code>forward</code> function.</p>
<p><img src="https://cdn.jsdelivr.net/gh/isSeymour/PicGo/posts/CS224W/Colab2/test.png" alt="test"></p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://pytorch-geometric.readthedocs.io/en/latest/modules/nn.html#torch_geometric.nn.conv.GCNConv">https://pytorch-geometric.readthedocs.io/en/latest/modules/nn.html#torch_geometric.nn.conv.GCNConv</a></p>
<p><a target="_blank" rel="noopener" href="https://pytorch.org/docs/stable/generated/torch.nn.BatchNorm1d.html">https://pytorch.org/docs/stable/generated/torch.nn.BatchNorm1d.html</a></p>
<p><a target="_blank" rel="noopener" href="https://pytorch.org/docs/stable/nn.functional.html">https://pytorch.org/docs/stable/nn.functional.html</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">from</span> torch_geometric.nn <span class="keyword">import</span> GCNConv</span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> BatchNorm1d, LogSoftmax, ModuleList</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GCN</span>(torch.nn.Module):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;GCN 模型&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, input_dim, hidden_dim, output_dim, num_layers,</span></span><br><span class="line"><span class="params">                 dropout, return_embeds=<span class="literal">False</span></span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;初始化&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="built_in">super</span>(GCN, self).__init__()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># A list of GCNConv layers</span></span><br><span class="line">        self.convs = ModuleList()</span><br><span class="line">        self.convs.append(GCNConv(input_dim, hidden_dim))</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num_layers - <span class="number">2</span>):</span><br><span class="line">            self.convs.append(GCNConv(hidden_dim, hidden_dim))</span><br><span class="line">        self.convs.append(GCNConv(hidden_dim, output_dim))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># A list of 1D batch normalization layers</span></span><br><span class="line">        self.bns = ModuleList([BatchNorm1d(hidden_dim) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num_layers - <span class="number">1</span>)])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># The log softmax layer</span></span><br><span class="line">        self.softmax = LogSoftmax(dim=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Probability of an element getting zeroed</span></span><br><span class="line">        self.dropout = dropout</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Skip classification layer and return node embeddings</span></span><br><span class="line">        self.return_embeds = return_embeds</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reset_parameters</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;重置参数&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> conv <span class="keyword">in</span> self.convs:</span><br><span class="line">            conv.reset_parameters()</span><br><span class="line">        <span class="keyword">for</span> bn <span class="keyword">in</span> self.bns:</span><br><span class="line">            bn.reset_parameters()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x, adj_t</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;前向传播&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="comment"># Forward pass through the network</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(self.convs) - <span class="number">1</span>):</span><br><span class="line">            x = self.convs[i](x, adj_t)</span><br><span class="line">            x = self.bns[i](x)</span><br><span class="line">            x = F.relu(x)</span><br><span class="line">            x = F.dropout(x, p=self.dropout, training=self.training)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Last convolutional layer (no batch normalization or ReLu)</span></span><br><span class="line">        x = self.convs[-<span class="number">1</span>](x, adj_t)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># If return_embeds is True, skip the softmax and return embeddings</span></span><br><span class="line">        <span class="keyword">if</span> self.return_embeds:</span><br><span class="line">            <span class="keyword">return</span> x</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Otherwise, apply log softmax for classification</span></span><br><span class="line">        out = self.softmax(x)</span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">train</span>(<span class="params">model, data, train_idx, optimizer, loss_fn</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;训练函数&#x27;&#x27;&#x27;</span></span><br><span class="line">    model.train()</span><br><span class="line">    <span class="comment"># 清空梯度</span></span><br><span class="line">    optimizer.zero_grad()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 模型输入输出</span></span><br><span class="line">    out = model(data.x, data.adj_t)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 计算损失</span></span><br><span class="line">    train_output = out[train_idx]</span><br><span class="line">    train_label = data.y[train_idx]</span><br><span class="line">    loss = loss_fn(train_output, train_label.squeeze())</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 反向传播 更新模型参数</span></span><br><span class="line">    loss.backward()</span><br><span class="line">    optimizer.step()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> loss.item()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Test function here</span></span><br><span class="line"><span class="meta">@torch.no_grad()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>(<span class="params">model, data, split_idx, evaluator, save_model_results=<span class="literal">False</span></span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;测试函数&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># 评估模式</span></span><br><span class="line">    model.<span class="built_in">eval</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取模型对所有数据的输出</span></span><br><span class="line">    out = model(data.x, data.adj_t)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 通过预测的最大概率类别得到 y_pred</span></span><br><span class="line">    y_pred = out.argmax(dim=-<span class="number">1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 准确率</span></span><br><span class="line">    train_acc = evaluator.<span class="built_in">eval</span>(&#123;</span><br><span class="line">        <span class="string">&#x27;y_true&#x27;</span>: data.y[split_idx[<span class="string">&#x27;train&#x27;</span>]],</span><br><span class="line">        <span class="string">&#x27;y_pred&#x27;</span>: y_pred[split_idx[<span class="string">&#x27;train&#x27;</span>]],</span><br><span class="line">    &#125;)[<span class="string">&#x27;acc&#x27;</span>]</span><br><span class="line">    valid_acc = evaluator.<span class="built_in">eval</span>(&#123;</span><br><span class="line">        <span class="string">&#x27;y_true&#x27;</span>: data.y[split_idx[<span class="string">&#x27;valid&#x27;</span>]],</span><br><span class="line">        <span class="string">&#x27;y_pred&#x27;</span>: y_pred[split_idx[<span class="string">&#x27;valid&#x27;</span>]],</span><br><span class="line">    &#125;)[<span class="string">&#x27;acc&#x27;</span>]</span><br><span class="line">    test_acc = evaluator.<span class="built_in">eval</span>(&#123;</span><br><span class="line">        <span class="string">&#x27;y_true&#x27;</span>: data.y[split_idx[<span class="string">&#x27;test&#x27;</span>]],</span><br><span class="line">        <span class="string">&#x27;y_pred&#x27;</span>: y_pred[split_idx[<span class="string">&#x27;test&#x27;</span>]],</span><br><span class="line">    &#125;)[<span class="string">&#x27;acc&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 保存结果</span></span><br><span class="line">    <span class="keyword">if</span> save_model_results:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;Saving Model Predictions&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        data = &#123;&#125;</span><br><span class="line">        data[<span class="string">&#x27;y_pred&#x27;</span>] = y_pred.view(-<span class="number">1</span>).cpu().detach().numpy()</span><br><span class="line">        </span><br><span class="line">        df = pd.DataFrame(data=data)</span><br><span class="line">        df.to_csv(<span class="string">&#x27;ogbn-arxiv_node.csv&#x27;</span>, sep=<span class="string">&#x27;,&#x27;</span>, index=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 返回测试函数准确率</span></span><br><span class="line">    <span class="keyword">return</span> train_acc, valid_acc, test_acc</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Please do not change the args</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;IS_GRADESCOPE_ENV&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> os.environ:</span><br><span class="line">    args = &#123;</span><br><span class="line">      <span class="string">&#x27;device&#x27;</span>: device,</span><br><span class="line">      <span class="string">&#x27;num_layers&#x27;</span>: <span class="number">3</span>,</span><br><span class="line">      <span class="string">&#x27;hidden_dim&#x27;</span>: <span class="number">256</span>,</span><br><span class="line">      <span class="string">&#x27;dropout&#x27;</span>: <span class="number">0.5</span>,</span><br><span class="line">      <span class="string">&#x27;lr&#x27;</span>: <span class="number">0.01</span>,</span><br><span class="line">      <span class="string">&#x27;epochs&#x27;</span>: <span class="number">100</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    args</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="string">&#x27;IS_GRADESCOPE_ENV&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> os.environ:</span><br><span class="line">    model = GCN(data.num_features, args[<span class="string">&#x27;hidden_dim&#x27;</span>],</span><br><span class="line">              dataset.num_classes, args[<span class="string">&#x27;num_layers&#x27;</span>],</span><br><span class="line">              args[<span class="string">&#x27;dropout&#x27;</span>]).to(device)</span><br><span class="line">    evaluator = Evaluator(name=<span class="string">&#x27;ogbn-arxiv&#x27;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Please do not change these args</span></span><br><span class="line"><span class="comment"># Training should take &lt;10min using GPU runtime</span></span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;IS_GRADESCOPE_ENV&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> os.environ:</span><br><span class="line">    <span class="comment"># reset the parameters to initial random value</span></span><br><span class="line">    model.reset_parameters()</span><br><span class="line"></span><br><span class="line">    optimizer = torch.optim.Adam(model.parameters(), lr=args[<span class="string">&#x27;lr&#x27;</span>])</span><br><span class="line">    loss_fn = F.nll_loss   <span class="comment"># 多分类问题的负对数似然损失函数</span></span><br><span class="line"></span><br><span class="line">    best_model = <span class="literal">None</span></span><br><span class="line">    best_valid_acc = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1</span> + args[<span class="string">&quot;epochs&quot;</span>]):</span><br><span class="line">        loss = train(model, data, train_idx, optimizer, loss_fn)</span><br><span class="line">        result = test(model, data, split_idx, evaluator)</span><br><span class="line">        train_acc, valid_acc, test_acc = result</span><br><span class="line">        <span class="keyword">if</span> valid_acc &gt; best_valid_acc:</span><br><span class="line">            best_valid_acc = valid_acc</span><br><span class="line">            best_model = copy.deepcopy(model)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;Epoch: <span class="subst">&#123;epoch:02d&#125;</span>, &#x27;</span></span><br><span class="line">              <span class="string">f&#x27;Loss: <span class="subst">&#123;loss:<span class="number">.4</span>f&#125;</span>, &#x27;</span></span><br><span class="line">              <span class="string">f&#x27;Train: <span class="subst">&#123;<span class="number">100</span> * train_acc:<span class="number">.2</span>f&#125;</span>%, &#x27;</span></span><br><span class="line">              <span class="string">f&#x27;Valid: <span class="subst">&#123;<span class="number">100</span> * valid_acc:<span class="number">.2</span>f&#125;</span>% &#x27;</span></span><br><span class="line">              <span class="string">f&#x27;Test: <span class="subst">&#123;<span class="number">100</span> * test_acc:<span class="number">.2</span>f&#125;</span>%&#x27;</span>)</span><br></pre></td></tr></table></figure>
<pre><code>Epoch: 01, Loss: 4.2264, Train: 19.30%, Valid: 25.86% Test: 23.30%
Epoch: 02, Loss: 2.3266, Train: 22.93%, Valid: 22.20% Test: 27.58%
Epoch: 03, Loss: 1.9266, Train: 29.55%, Valid: 26.12% Test: 31.58%
Epoch: 04, Loss: 1.7227, Train: 32.78%, Valid: 33.06% Test: 35.57%
Epoch: 05, Loss: 1.6185, Train: 35.70%, Valid: 32.67% Test: 33.84%
Epoch: 06, Loss: 1.5277, Train: 39.24%, Valid: 35.68% Test: 35.93%
Epoch: 07, Loss: 1.4655, Train: 43.58%, Valid: 43.85% Test: 45.12%
Epoch: 08, Loss: 1.4239, Train: 47.11%, Valid: 49.65% Test: 51.94%
Epoch: 09, Loss: 1.3798, Train: 47.55%, Valid: 49.59% Test: 52.15%
Epoch: 10, Loss: 1.3428, Train: 47.21%, Valid: 48.50% Test: 51.24%
...
Epoch: 95, Loss: 0.9132, Train: 73.62%, Valid: 71.05% Test: 69.49%
Epoch: 96, Loss: 0.9135, Train: 73.67%, Valid: 71.52% Test: 70.41%
Epoch: 97, Loss: 0.9091, Train: 73.74%, Valid: 71.47% Test: 69.89%
Epoch: 98, Loss: 0.9096, Train: 73.82%, Valid: 71.75% Test: 70.59%
Epoch: 99, Loss: 0.9087, Train: 73.90%, Valid: 71.91% Test: 71.12%
Epoch: 100, Loss: 0.9057, Train: 74.07%, Valid: 71.67% Test: 70.79%
</code></pre>
<h2 id="Question-5-What-are-your-best-model-validation-and-test-accuracies-20-points">Question 5: What are your <code>best_model</code> validation and test accuracies?(20 points)</h2>
<p>Run the cell below to see the results of your best of model and save your model’s predictions to a file named <em>ogbn-arxiv_node.csv</em>. You can view this file by clicking on the <em>Folder</em> icon on the left side pannel. Report the results on Gradescope.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="string">&#x27;IS_GRADESCOPE_ENV&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> os.environ:</span><br><span class="line">    best_result = test(best_model, data, split_idx, evaluator, save_model_results=<span class="literal">True</span>)</span><br><span class="line">    train_acc, valid_acc, test_acc = best_result</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Best model: &#x27;</span></span><br><span class="line">        <span class="string">f&#x27;Train: <span class="subst">&#123;<span class="number">100</span> * train_acc:<span class="number">.2</span>f&#125;</span>%, &#x27;</span></span><br><span class="line">        <span class="string">f&#x27;Valid: <span class="subst">&#123;<span class="number">100</span> * valid_acc:<span class="number">.2</span>f&#125;</span>% &#x27;</span></span><br><span class="line">        <span class="string">f&#x27;Test: <span class="subst">&#123;<span class="number">100</span> * test_acc:<span class="number">.2</span>f&#125;</span>%&#x27;</span>)</span><br></pre></td></tr></table></figure>
<pre><code>Saving Model Predictions
Best model: Train: 73.90%, Valid: 71.91% Test: 71.12%
</code></pre>
<h1>4) GNN: Graph Property Prediction</h1>
<p>In this section we will create a graph neural network for graph property prediction (graph classification).</p>
<h2 id="Load-and-preprocess-the-dataset">Load and preprocess the dataset</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ogb.graphproppred <span class="keyword">import</span> PygGraphPropPredDataset, Evaluator</span><br><span class="line"><span class="keyword">from</span> torch_geometric.loader <span class="keyword">import</span> DataLoader</span><br><span class="line"><span class="keyword">from</span> tqdm.notebook <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;IS_GRADESCOPE_ENV&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> os.environ:</span><br><span class="line">    <span class="comment"># Load the dataset</span></span><br><span class="line">    dataset = PygGraphPropPredDataset(name=<span class="string">&#x27;ogbg-molhiv&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    device = <span class="string">&#x27;cuda&#x27;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&#x27;cpu&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Device: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(device))</span><br><span class="line"></span><br><span class="line">    split_idx = dataset.get_idx_split()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Check task type</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Task type: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(dataset.task_type))</span><br></pre></td></tr></table></figure>
<pre><code>Device: cpu
Task type: binary classification
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Load the dataset splits into corresponding dataloaders</span></span><br><span class="line"><span class="comment"># We will train the graph classification task on a batch of 32 graphs</span></span><br><span class="line"><span class="comment"># Shuffle the order of graphs for training set</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;IS_GRADESCOPE_ENV&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> os.environ:</span><br><span class="line">    train_loader = DataLoader(dataset[split_idx[<span class="string">&quot;train&quot;</span>]], batch_size=<span class="number">32</span>, shuffle=<span class="literal">True</span>, num_workers=<span class="number">0</span>)</span><br><span class="line">    valid_loader = DataLoader(dataset[split_idx[<span class="string">&quot;valid&quot;</span>]], batch_size=<span class="number">32</span>, shuffle=<span class="literal">False</span>, num_workers=<span class="number">0</span>)</span><br><span class="line">    test_loader = DataLoader(dataset[split_idx[<span class="string">&quot;test&quot;</span>]], batch_size=<span class="number">32</span>, shuffle=<span class="literal">False</span>, num_workers=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="string">&#x27;IS_GRADESCOPE_ENV&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> os.environ:</span><br><span class="line">    <span class="comment"># Please do not change the args</span></span><br><span class="line">    args = &#123;</span><br><span class="line">      <span class="string">&#x27;device&#x27;</span>: device,</span><br><span class="line">      <span class="string">&#x27;num_layers&#x27;</span>: <span class="number">5</span>,</span><br><span class="line">      <span class="string">&#x27;hidden_dim&#x27;</span>: <span class="number">256</span>,</span><br><span class="line">      <span class="string">&#x27;dropout&#x27;</span>: <span class="number">0.5</span>,</span><br><span class="line">      <span class="string">&#x27;lr&#x27;</span>: <span class="number">0.001</span>,</span><br><span class="line">      <span class="string">&#x27;epochs&#x27;</span>: <span class="number">30</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    args</span><br></pre></td></tr></table></figure>
<h2 id="Graph-Prediction-Model">Graph Prediction Model</h2>
<h3 id="Graph-Mini-Batching">Graph Mini-Batching</h3>
<p>Before diving into the actual model, we introduce the concept of mini-batching with graphs. In order to parallelize the processing of a mini-batch of graphs, PyG combines the graphs into a single disconnected graph data object (<em>torch_geometric.data.Batch</em>). <em>torch_geometric.data.Batch</em> inherits from <em>torch_geometric.data.Data</em> (introduced earlier) and contains an additional attribute called <code>batch</code>.</p>
<p>The <code>batch</code> attribute is a vector mapping each node to the index of its corresponding graph within the mini-batch:</p>
<pre><code>batch = [0, ..., 0, 1, ..., n - 2, n - 1, ..., n - 1]
</code></pre>
<p>This attribute is crucial for associating which graph each node belongs to and can be used to e.g. average the node embeddings for each graph individually to compute graph level embeddings.</p>
<h3 id="Implemention">Implemention</h3>
<p>Now, we have all of the tools to implement a GCN Graph Prediction model!</p>
<p>We will reuse the existing GCN model to generate <code>node_embeddings</code> and then use  <code>Global Pooling</code> over the nodes to create graph level embeddings that can be used to predict properties for the each graph. Remeber that the <code>batch</code> attribute will be essential for performining Global Pooling over our mini-batch of graphs.</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://pytorch-geometric.readthedocs.io/en/latest/modules/nn.html#global-pooling-layers">https://pytorch-geometric.readthedocs.io/en/latest/modules/nn.html#global-pooling-layers</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ogb.graphproppred.mol_encoder <span class="keyword">import</span> AtomEncoder</span><br><span class="line"><span class="keyword">from</span> torch_geometric.nn <span class="keyword">import</span> global_add_pool, global_mean_pool</span><br><span class="line"></span><br><span class="line"><span class="comment">### GCN to predict graph property</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GCN_Graph</span>(torch.nn.Module):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;预测图的属性&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, hidden_dim, output_dim, num_layers, dropout</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;初始化&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="built_in">super</span>(GCN_Graph, self).__init__()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 加载分子图中原子的编码器</span></span><br><span class="line">        self.node_encoder = AtomEncoder(hidden_dim)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Node embedding model</span></span><br><span class="line">        <span class="comment"># 注意输入输出维度都是 hidden_dim</span></span><br><span class="line">        self.gnn_node = GCN(hidden_dim, hidden_dim, hidden_dim, num_layers, dropout, return_embeds=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 全局池化层(均值池化)</span></span><br><span class="line">        self.pool = global_mean_pool</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 输出层，用于预测每个图的属性</span></span><br><span class="line">        self.linear = torch.nn.Linear(hidden_dim, output_dim)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reset_parameters</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;重置模型参数&#x27;&#x27;&#x27;</span></span><br><span class="line">        self.gnn_node.reset_parameters()</span><br><span class="line">        self.linear.reset_parameters()</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, batched_data</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;前向传播&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="comment"># 获取小批量图中的重要属性</span></span><br><span class="line">        x, edge_index, batch = batched_data.x, batched_data.edge_index, batched_data.batch</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 使用节点编码器对节点特征进行编码</span></span><br><span class="line">        embed = self.node_encoder(x)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 使用 GCN 模型生成节点嵌入</span></span><br><span class="line">        node_embeddings = self.gnn_node(embed, edge_index)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 使用全局均值池化，将节点嵌入聚合为图嵌入</span></span><br><span class="line">        graph_embeddings = self.pool(node_embeddings, batch)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 通过线性层预测每个图的属性</span></span><br><span class="line">        out = self.linear(graph_embeddings)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">train</span>(<span class="params">model, device, data_loader, optimizer, loss_fn</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;训练函数&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># 训练模式</span></span><br><span class="line">    model.train()</span><br><span class="line">    total_loss = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 加载数据加载器中的小批量数据</span></span><br><span class="line">    <span class="keyword">for</span> step, batch <span class="keyword">in</span> <span class="built_in">enumerate</span>(tqdm(data_loader, desc=<span class="string">&quot;Iteration&quot;</span>)):</span><br><span class="line">        batch = batch.to(device)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 如果批次中的节点数目为 1 ，或所有节点都属于同一个图，跳过（无效批次）</span></span><br><span class="line">        <span class="keyword">if</span> batch.x.shape[<span class="number">0</span>] == <span class="number">1</span> <span class="keyword">or</span> batch.batch[-<span class="number">1</span>] == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 1. 清空优化器梯度</span></span><br><span class="line">            optimizer.zero_grad()</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 2. 模型输入输出</span></span><br><span class="line">            out = model(batch)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 3. 计算损失（使用 is_labeled 掩码过滤输出和标签，忽略 NaN 标签）</span></span><br><span class="line">            is_labeled = batch.y == batch.y</span><br><span class="line">            out = out[is_labeled]</span><br><span class="line">            labels = batch.y[is_labeled].to(torch.float32)</span><br><span class="line">            loss = loss_fn(out, labels)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 4. 反向传播 更新参数</span></span><br><span class="line">            loss.backward()</span><br><span class="line">            optimizer.step()</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 累加损失</span></span><br><span class="line">            total_loss += loss.item()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> total_loss / <span class="built_in">len</span>(data_loader)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The evaluation function</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">eval</span>(<span class="params">model, device, loader, evaluator, save_model_results=<span class="literal">False</span>, save_file=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;测试函数&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># 评估模式</span></span><br><span class="line">    model.<span class="built_in">eval</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 真实标签 预测标签</span></span><br><span class="line">    y_true = []</span><br><span class="line">    y_pred = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 按批次测试</span></span><br><span class="line">    <span class="keyword">for</span> step, batch <span class="keyword">in</span> <span class="built_in">enumerate</span>(tqdm(loader, desc=<span class="string">&quot;Iteration&quot;</span>)):</span><br><span class="line">        batch = batch.to(device)</span><br><span class="line">        <span class="comment"># 若只有一个节点，跳过（避免单一节点对评估产生偏差）</span></span><br><span class="line">        <span class="keyword">if</span> batch.x.shape[<span class="number">0</span>] == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 预测</span></span><br><span class="line">            <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">                pred = model(batch)</span><br><span class="line">            <span class="comment"># 预测结果</span></span><br><span class="line">            y_true.append(batch.y.view(pred.shape).detach().cpu())</span><br><span class="line">            y_pred.append(pred.detach().cpu())</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 拼接成一个长向量，转为numpy数组，字典存储</span></span><br><span class="line">    y_true = torch.cat(y_true, dim = <span class="number">0</span>).numpy()</span><br><span class="line">    y_pred = torch.cat(y_pred, dim = <span class="number">0</span>).numpy()</span><br><span class="line">    input_dict = &#123;<span class="string">&quot;y_true&quot;</span>: y_true, <span class="string">&quot;y_pred&quot;</span>: y_pred&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 保存结果</span></span><br><span class="line">    <span class="keyword">if</span> save_model_results:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;Saving Model Predictions&quot;</span>)</span><br><span class="line"></span><br><span class="line">        data = &#123;&#125;</span><br><span class="line">        data[<span class="string">&#x27;y_pred&#x27;</span>] = y_pred.reshape(-<span class="number">1</span>)</span><br><span class="line">        data[<span class="string">&#x27;y_true&#x27;</span>] = y_true.reshape(-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        df = pd.DataFrame(data=data)</span><br><span class="line">        df.to_csv(<span class="string">&#x27;ogbg-molhiv_graph_&#x27;</span> + save_file + <span class="string">&#x27;.csv&#x27;</span>, sep=<span class="string">&#x27;,&#x27;</span>, index=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 调用评估器，返回评估指标</span></span><br><span class="line">    <span class="keyword">return</span> evaluator.<span class="built_in">eval</span>(input_dict)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="string">&#x27;IS_GRADESCOPE_ENV&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> os.environ:</span><br><span class="line">    model = GCN_Graph(args[<span class="string">&#x27;hidden_dim&#x27;</span>],</span><br><span class="line">                      dataset.num_tasks, args[<span class="string">&#x27;num_layers&#x27;</span>],</span><br><span class="line">                      args[<span class="string">&#x27;dropout&#x27;</span>]).to(device)</span><br><span class="line">    evaluator = Evaluator(name=<span class="string">&#x27;ogbg-molhiv&#x27;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Please do not change these args</span></span><br><span class="line"><span class="comment"># Training should take &lt;10min using GPU runtime</span></span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;IS_GRADESCOPE_ENV&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> os.environ:</span><br><span class="line">    model.reset_parameters()</span><br><span class="line"></span><br><span class="line">    optimizer = torch.optim.Adam(model.parameters(), lr=args[<span class="string">&#x27;lr&#x27;</span>])</span><br><span class="line">    loss_fn = torch.nn.BCEWithLogitsLoss()</span><br><span class="line"></span><br><span class="line">    best_model = <span class="literal">None</span></span><br><span class="line">    best_valid_acc = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1</span> + args[<span class="string">&quot;epochs&quot;</span>]):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Training...&#x27;</span>)</span><br><span class="line">        loss = train(model, device, train_loader, optimizer, loss_fn)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Evaluating...&#x27;</span>)</span><br><span class="line">        train_result = <span class="built_in">eval</span>(model, device, train_loader, evaluator)</span><br><span class="line">        val_result = <span class="built_in">eval</span>(model, device, valid_loader, evaluator)</span><br><span class="line">        test_result = <span class="built_in">eval</span>(model, device, test_loader, evaluator)</span><br><span class="line"></span><br><span class="line">        train_acc, valid_acc, test_acc = train_result[dataset.eval_metric], val_result[dataset.eval_metric], test_result[dataset.eval_metric]</span><br><span class="line">        <span class="keyword">if</span> valid_acc &gt; best_valid_acc:</span><br><span class="line">            best_valid_acc = valid_acc</span><br><span class="line">            best_model = copy.deepcopy(model)</span><br><span class="line">            </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;Epoch: <span class="subst">&#123;epoch:02d&#125;</span>, &#x27;</span></span><br><span class="line">              <span class="string">f&#x27;Loss: <span class="subst">&#123;loss:<span class="number">.4</span>f&#125;</span>, &#x27;</span></span><br><span class="line">              <span class="string">f&#x27;Train: <span class="subst">&#123;<span class="number">100</span> * train_acc:<span class="number">.2</span>f&#125;</span>%, &#x27;</span></span><br><span class="line">              <span class="string">f&#x27;Valid: <span class="subst">&#123;<span class="number">100</span> * valid_acc:<span class="number">.2</span>f&#125;</span>% &#x27;</span></span><br><span class="line">              <span class="string">f&#x27;Test: <span class="subst">&#123;<span class="number">100</span> * test_acc:<span class="number">.2</span>f&#125;</span>%&#x27;</span>)</span><br></pre></td></tr></table></figure>
<pre><code>Training...
Iteration:   0%|          | 0/1029 [00:00&lt;?, ?it/s]
Evaluating...
Iteration:   0%|          | 0/1029 [00:00&lt;?, ?it/s]
Iteration:   0%|          | 0/129 [00:00&lt;?, ?it/s]
Iteration:   0%|          | 0/129 [00:00&lt;?, ?it/s]
Epoch: 01, Loss: 0.1584, Train: 68.88%, Valid: 62.36% Test: 62.30%

Training...
Iteration:   0%|          | 0/1029 [00:00&lt;?, ?it/s]
Evaluating...
Iteration:   0%|          | 0/1029 [00:00&lt;?, ?it/s]
Iteration:   0%|          | 0/129 [00:00&lt;?, ?it/s]
Iteration:   0%|          | 0/129 [00:00&lt;?, ?it/s]
Epoch: 02, Loss: 0.1501, Train: 72.18%, Valid: 74.67% Test: 70.18%

...
Epoch: 29, Loss: 0.1252, Train: 84.55%, Valid: 77.83% Test: 74.29%

Training...
Iteration:   0%|          | 0/1029 [00:00&lt;?, ?it/s]
Evaluating...
Iteration:   0%|          | 0/1029 [00:00&lt;?, ?it/s]
Iteration:   0%|          | 0/129 [00:00&lt;?, ?it/s]
Iteration:   0%|          | 0/129 [00:00&lt;?, ?it/s]
Epoch: 30, Loss: 0.1249, Train: 84.06%, Valid: 78.64% Test: 75.13%
</code></pre>
<h2 id="Question-6-What-are-your-best-model-validation-and-test-ROC-AUC-scores-20-points">Question 6: What are your <code>best_model</code> validation and test ROC-AUC scores? (20 points)</h2>
<p>Run the cell below to see the results of your best of model and save your model’s predictions in files named <em>ogbg-molhiv_graph_[valid,test].csv</em>. Again, you can view the files by clicking on the <em>Folder</em> icon on the left side pannel. Report the results on Gradescope.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="string">&#x27;IS_GRADESCOPE_ENV&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> os.environ:</span><br><span class="line">    train_auroc = <span class="built_in">eval</span>(best_model, device, train_loader, evaluator)[dataset.eval_metric]</span><br><span class="line">    valid_auroc = <span class="built_in">eval</span>(best_model, device, valid_loader, evaluator, save_model_results=<span class="literal">True</span>, save_file=<span class="string">&quot;valid&quot;</span>)[dataset.eval_metric]</span><br><span class="line">    test_auroc  = <span class="built_in">eval</span>(best_model, device, test_loader, evaluator, save_model_results=<span class="literal">True</span>, save_file=<span class="string">&quot;test&quot;</span>)[dataset.eval_metric]</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Best model: &#x27;</span></span><br><span class="line">      <span class="string">f&#x27;Train: <span class="subst">&#123;<span class="number">100</span> * train_auroc:<span class="number">.2</span>f&#125;</span>%, &#x27;</span></span><br><span class="line">      <span class="string">f&#x27;Valid: <span class="subst">&#123;<span class="number">100</span> * valid_auroc:<span class="number">.2</span>f&#125;</span>% &#x27;</span></span><br><span class="line">      <span class="string">f&#x27;Test: <span class="subst">&#123;<span class="number">100</span> * test_auroc:<span class="number">.2</span>f&#125;</span>%&#x27;</span>)</span><br></pre></td></tr></table></figure>
<pre><code>Iteration:   0%|          | 0/1029 [00:00&lt;?, ?it/s]
Iteration:   0%|          | 0/129 [00:00&lt;?, ?it/s]
Saving Model Predictions
Iteration:   0%|          | 0/129 [00:00&lt;?, ?it/s]
Saving Model Predictions
Best model: Train: 81.89%, Valid: 80.14% Test: 74.33%
</code></pre>
<h2 id="Question-7-Optional-Experiment-with-the-two-other-global-pooling-layers-in-Pytorch-Geometric">Question 7 (Optional): Experiment with the two other global pooling layers in Pytorch Geometric.</h2>
<h1>Submission</h1>
<p>To submit Colab 2, please submit to the following assignments on Gradescope:</p>
<ol>
<li>“Colab 2”: submit your answers to the questions in this assignment</li>
<li>“Colab 2 Code”: submit your completed <em>CS224W_Colab_2.ipynb</em>. From the “File” menu select “Download .ipynb” to save a local copy of your completed Colab. <strong>PLEASE DO NOT CHANGE THE NAME!</strong> The autograder depends on the .ipynb file being called “CS224W_Colab_2.ipynb”.</li>
</ol>
<p>Clarrification:</p>
<ul>
<li>In “Colab 2 Code”, we grade Q1-Q4 (non-training questions) using autograder.</li>
<li>In “Colab 2”, we grade Q5-Q6 (training questions), where Q1-Q4 are assigned 0 points.</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://isSeymour.github.io/butterflyblog">isSeymour</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://isseymour.github.io/butterflyblog/2024/10/14/CS224W_Colab_2/">https://isseymour.github.io/butterflyblog/2024/10/14/CS224W_Colab_2/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://isSeymour.github.io/butterflyblog" target="_blank">isSeymour</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/butterflyblog/tags/GNN/">GNN</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/isSeymour/PicGo/posts/CS224W/GCN/shared-parameters.png" data-sites="wechat,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/Seymour0314/PicGo/blog/pay/PAY1.jpg" target="_blank"><img class="post-qr-code-img" src="https://cdn.jsdelivr.net/gh/Seymour0314/PicGo/blog/pay/PAY1.jpg" alt="微信支付"/></a><div class="post-qr-code-desc">微信支付</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/Seymour0314/PicGo/blog/pay/PAY2.jpg" target="_blank"><img class="post-qr-code-img" src="https://cdn.jsdelivr.net/gh/Seymour0314/PicGo/blog/pay/PAY2.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/butterflyblog/2024/10/14/GCN/" title="GCN 图卷积神经网络"><img class="cover" src="https://cdn.jsdelivr.net/gh/isSeymour/PicGo/posts/CS224W/GCN/DeepGraphEncoders.png" onerror="onerror=null;src='https://cdn.jsdelivr.net/gh/Seymour0314/PicGo/blog/page_img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">GCN 图卷积神经网络</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/butterflyblog/2024/10/10/CS224W_Colab_1/" title="CS224W - Colab 1"><img class="cover" src="https://cdn.jsdelivr.net/gh/isSeymour/PicGo/posts/CS224W/Colab1/output_41_0.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-10</div><div class="title">CS224W - Colab 1</div></div></a></div><div><a href="/butterflyblog/2024/10/10/CS224W_Colab_0/" title="CS224W - Colab 0"><img class="cover" src="https://cdn.jsdelivr.net/gh/isSeymour/PicGo/posts/CS224W/Colab0/output_41_0.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-10</div><div class="title">CS224W - Colab 0</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/Seymour0314/PicGo/blog/page_img/T6.jpg" onerror="this.onerror=null;this.src='https://cdn.jsdelivr.net/gh/Seymour0314/PicGo/blog/page_img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">isSeymour</div><div class="author-info__description">志之所趋，无远弗届，穷山距海，不能限也。</div></div><div class="card-info-data site-data is-center"><a href="/butterflyblog/archives/"><div class="headline">文章</div><div class="length-num">67</div></a><a href="/butterflyblog/tags/"><div class="headline">标签</div><div class="length-num">34</div></a><a href="/butterflyblog/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/isSeymour/"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://isSeymour.github.io/profile/" target="_blank" title="学术主页"><i class="fa-regular fa-address-card" style="color: #000000;"></i></a><a class="social-icon" href="https://github.com/isSeymour/" target="_blank" title="Github"><i class="fab fa-github" style="color: #hdhfbb;"></i></a><a class="social-icon" href="https://space.bilibili.com/79699613/" target="_blank" title="B站"><i class="fa-brands fa-bilibili" style="color: #000000;"></i></a><a class="social-icon" href="https://blog.csdn.net/m0_63205991/" target="_blank" title="CSDN"><i class="fa-solid fa-code" style="color: #000000;"></i></a><a class="social-icon" href="mailto:isSeymour@163.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #000000;"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">CS224W - Colab 2</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">Device</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">Setup</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">1) PyTorch Geometric (Datasets and Data)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#PyG-Datasets"><span class="toc-text">PyG Datasets</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-1-What-is-the-number-of-classes-and-number-of-features-in-the-ENZYMES-dataset-5-points"><span class="toc-text">Question 1: What is the number of classes and number of features in the ENZYMES dataset? (5 points)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PyG-Data"><span class="toc-text">PyG Data</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-2-What-is-the-label-of-the-graph-with-index-100-in-the-ENZYMES-dataset-5-points"><span class="toc-text">Question 2: What is the label of the graph with index 100 in the ENZYMES dataset? (5 points)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-3-How-many-edges-does-the-graph-with-index-200-have-5-points"><span class="toc-text">Question 3: How many edges does the graph with index 200 have? (5 points)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">2) Open Graph Benchmark (OGB)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Dataset-and-Data"><span class="toc-text">Dataset and Data</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-4-How-many-features-are-in-the-ogbn-arxiv-graph-5-points"><span class="toc-text">Question 4: How many features are in the ogbn-arxiv graph? (5 points)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">3) GNN: Node Property Prediction</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Setup"><span class="toc-text">Setup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Load-and-Preprocess-the-Dataset"><span class="toc-text">Load and Preprocess the Dataset</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GCN-Model"><span class="toc-text">GCN Model</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-5-What-are-your-best-model-validation-and-test-accuracies-20-points"><span class="toc-text">Question 5: What are your best_model validation and test accuracies?(20 points)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">4) GNN: Graph Property Prediction</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Load-and-preprocess-the-dataset"><span class="toc-text">Load and preprocess the dataset</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Graph-Prediction-Model"><span class="toc-text">Graph Prediction Model</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Graph-Mini-Batching"><span class="toc-text">Graph Mini-Batching</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Implemention"><span class="toc-text">Implemention</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-6-What-are-your-best-model-validation-and-test-ROC-AUC-scores-20-points"><span class="toc-text">Question 6: What are your best_model validation and test ROC-AUC scores? (20 points)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-7-Optional-Experiment-with-the-two-other-global-pooling-layers-in-Pytorch-Geometric"><span class="toc-text">Question 7 (Optional): Experiment with the two other global pooling layers in Pytorch Geometric.</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">Submission</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/butterflyblog/2024/10/14/CS224W_Colab_2/" title="CS224W - Colab 2"><img src="https://cdn.jsdelivr.net/gh/isSeymour/PicGo/posts/CS224W/GCN/shared-parameters.png" onerror="this.onerror=null;this.src='https://cdn.jsdelivr.net/gh/Seymour0314/PicGo/blog/page_img/404.jpg'" alt="CS224W - Colab 2"/></a><div class="content"><a class="title" href="/butterflyblog/2024/10/14/CS224W_Colab_2/" title="CS224W - Colab 2">CS224W - Colab 2</a><time datetime="2024-10-14T14:00:00.000Z" title="发表于 2024-10-14 22:00:00">2024-10-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/butterflyblog/2024/10/14/GCN/" title="GCN 图卷积神经网络"><img src="https://cdn.jsdelivr.net/gh/isSeymour/PicGo/posts/CS224W/GCN/DeepGraphEncoders.png" onerror="this.onerror=null;this.src='https://cdn.jsdelivr.net/gh/Seymour0314/PicGo/blog/page_img/404.jpg'" alt="GCN 图卷积神经网络"/></a><div class="content"><a class="title" href="/butterflyblog/2024/10/14/GCN/" title="GCN 图卷积神经网络">GCN 图卷积神经网络</a><time datetime="2024-10-14T09:00:00.000Z" title="发表于 2024-10-14 17:00:00">2024-10-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/butterflyblog/2024/10/12/Graph-PageRank/" title="PageRank:《哈利·波特》人物节点重要度"><img src="https://cdn.jsdelivr.net/gh/isSeymour/PicGo/posts/CS224W/PageRank/Algorithm.png" onerror="this.onerror=null;this.src='https://cdn.jsdelivr.net/gh/Seymour0314/PicGo/blog/page_img/404.jpg'" alt="PageRank:《哈利·波特》人物节点重要度"/></a><div class="content"><a class="title" href="/butterflyblog/2024/10/12/Graph-PageRank/" title="PageRank:《哈利·波特》人物节点重要度">PageRank:《哈利·波特》人物节点重要度</a><time datetime="2024-10-12T14:00:00.000Z" title="发表于 2024-10-12 22:00:00">2024-10-12</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/isSeymour/PicGo/posts/CS224W/GCN/shared-parameters.png')"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By isSeymour</div><div class="footer_custom_text">欢迎乘坐我的生活地铁！</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/butterflyblog/js/utils.js"></script><script src="/butterflyblog/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>(() => {
  const initGitalk = () => {
    const gitalk = new Gitalk(Object.assign({
      clientID: 'Ov23liAZxomGv7Hapw8g',
      clientSecret: 'f7cafde192c4ada8bef4b76952c422d90575cf8b',
      repo: 'gitalk',
      owner: 'isSeymour',
      admin: ['isSeymour'],
      id: 'd55afd2222fbe28756baee119162f2a9',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  const loadGitalk = async() => {
    if (typeof Gitalk === 'function') initGitalk()
    else {
      await getCSS('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css')
      await getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js')
      initGitalk()
    }
  }
  
  const commentCount = n => {
    const isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
    if (isCommentCount) {
      isCommentCount.textContent= n
    }
  }

  if ('Gitalk' === 'Gitalk' || !false) {
    if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
    else loadGitalk()
  } else {
    window.loadOtherComment = loadGitalk
  }
})()</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/butterflyblog/js/search/local-search.js"></script></div></div></body></html>